subsystem = ESW
component = APSAcquisitionSequencer
description = """
    The APSAcquisitionSequencer is created by ESW to manage APS runs. As a Sequencer it sends
    commands to other subsystems including TCS and APS ICD.

    In the APS scenario it also receives commands from PEAS acting as the system user interface.
"""

receive = [
    {
        name = presetWithPosition
        description = """
            Receive target coordinates from APS and take actions to preset the telescope.
            **presetWithPosition** configures TCS to preset from position provided by the caller.

            This is related to *preset* in section 3.6.3 in APS ICD SDD
            """
        requiredArgs = [base]
        completionType = longRunning
        parameters = [
            {
                name = base
                description = """
                    Base Target Position that includes RA/Dec, proper motions, and others.
                    """
                type = eqCoord
            }
        ]
    },
    {
        name = presetWithCatalogID
        description = """
            Receive a selected target ID from APS and take actions to preset the telescope.
            **presetWithCatalogId** configures TCS to preset from a catalog entry within
            a DMS.CAT catalog.

            This is related to *preset* in section 3.6.3 in APS SDD.
            """
        requiredArgs = [catalogId, objectId]
        completionType = longRunning
        parameters = [
            {
                name = catalogId
                description = """
                    The identifier of the catalog in the DMS.CAT services. In custom catalogs, this
                    is the *catalogId* value of the object's catalog.
                """
                type = string
            },
            {
                name = objectId
                description = """
                    The object identifier of the object in the catalog selected with *catalogId*. In
                    custom catalogs, this is the *objectId* of the desired catalog object.

                    In read-only catalogs of DMS.CAT this field can be catalog-specific, but should
                    always be specified with *objectId* in this command.
                    """
                type = string
            }
        ]
    }
    {
        name = coarseAcquisition
        description = """
            Coordinate activites to roughly align the target star on the APT detector
            and prepare for guiding. The ESW will use the APT detector to take images
            of the target and adjust exposure settings as needed to obtain the flux
            required for proper centroiding.  Then the ESW will offset telesecope to position
            the star within the required tolerance.  No arguments are needed for this
            procedure.  Information about the target obtained during preset are kept as state
            within the sequenecr.
            """
        completionType = longRunning
    }
    {
        name = startGuiding
        description = """
            Start the APS guiding loop.  This is primarily handled by the APS.
            This command initiates this process by sending the command to the ICS Sequencer.
            """
    }
]

send = [
    // Used by initial setup to new target, Fig 3-9
    {
        name=setupAPTForAcquisition
        subsystem=APS
        component=ICS.ICS.Sequencer
    }
    {
        name=setMode
        subsystem=APS
        component=ICS.FOC.KMirror
    }
    // Used by coarse exposure, Fig 3-13
    {
        name=takeAPTExposure
        subsystem=APS
        component=ICS.ICS.Sequencer
    }
    {
        name=adjustFluxAndTakeAPTExposure
        subsystem=APS
        component=ICS.ICS.Sequencer
    }
    // Used by Start Guiding, Fig 3-15
    {
        name=setupAndStartAPTGuiding
        subsystem=APS
        component=ICS.ICS.Sequencer
    }
    {
        name=startGuiding
        subsystem=TCS
        component=tcsSeq
    }
    // Called to adjust guiding during an ongoing observation
    {
        name=adjustAPTWhileGuiding
        subsystem=APS
        component=ICS.ICS.Sequencer
    }

]